<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tekstil CRM - YÃ¶netim Paneli</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background-color: #f4f6f9; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        /* GÄ°RÄ°Åž EKRANI STÄ°LLERÄ° */
        .login-wrapper { height: 100vh; display: flex; align-items: center; justify-content: center; }
        .login-card { width: 100%; max-width: 400px; padding: 30px; border-radius: 15px; background: white; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }

        /* DASHBOARD STÄ°LLERÄ° */
        #dashboardSection { display: none; height: 100vh; overflow: hidden; }
        .sidebar { width: 250px; background: #2c3e50; color: white; display: flex; flex-direction: column; height: 100%; transition: all 0.3s; }
        .sidebar-header { padding: 20px; text-align: center; border-bottom: 1px solid #34495e; }
        .sidebar-menu { flex: 1; padding: 20px 0; overflow-y: auto; }
        .menu-item { display: block; padding: 12px 20px; color: #ecf0f1; text-decoration: none; transition: 0.3s; cursor: pointer; }
        .menu-item:hover, .menu-item.active { background: #34495e; border-left: 4px solid #3498db; }
        .menu-item i { width: 25px; }
        
        .main-content { flex: 1; overflow-y: auto; padding: 20px; background: #f4f6f9; }
        .header-bar { background: white; padding: 15px 25px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        
        /* KARTLAR */
        .stat-card { background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .table-responsive { background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

        /* Mobil Uyum */
        @media (max-width: 768px) {
            .sidebar { position: fixed; left: -250px; z-index: 1000; }
            .sidebar.active { left: 0; }
        }
    </style>
</head>
<body>

    <div id="loginSection" class="login-wrapper">
        <div class="login-card">
            <h3 class="text-center text-primary mb-4 fw-bold">ðŸ‘” Tekstil CRM</h3>
            <form id="loginForm">
                <div class="mb-3">
                    <label class="form-label">KullanÄ±cÄ± AdÄ±</label>
                    <input type="text" id="username" class="form-control" required>
                </div>
                <div class="mb-4">
                    <label class="form-label">Åžifre</label>
                    <input type="password" id="password" class="form-control" required>
                </div>
                <button type="submit" id="loginBtn" class="btn btn-primary w-100 py-2">GiriÅŸ Yap</button>
            </form>
            <div id="loginError" class="alert alert-danger mt-3 d-none text-center small"></div>
        </div>
    </div>

    <div id="dashboardSection" class="d-flex">
        
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h4>Tekstil CRM</h4>
                <small class="text-muted">v3.0 Secure</small>
            </div>
            <div class="sidebar-menu">
                <a onclick="loadPage('home')" class="menu-item active" id="nav-home">
                    <i class="fas fa-home"></i> Ana Sayfa
                </a>
                <a onclick="loadPage('customers')" class="menu-item" id="nav-customers">
                    <i class="fas fa-users"></i> MÃ¼ÅŸteriler
                </a>
                <a onclick="loadPage('tasks')" class="menu-item" id="nav-tasks">
                    <i class="fas fa-tasks"></i> GÃ¶revler
                </a>
                <a onclick="loadPage('offers')" class="menu-item" id="nav-offers">
                    <i class="fas fa-file-invoice-dollar"></i> Teklifler
                </a>
                <hr style="border-color: #7f8c8d;">
                <a onclick="logout()" class="menu-item text-danger">
                    <i class="fas fa-sign-out-alt"></i> Ã‡Ä±kÄ±ÅŸ Yap
                </a>
            </div>
        </nav>

        <main class="main-content">
            <div class="header-bar">
                <h5 id="pageTitle" class="m-0 fw-bold text-secondary">Ana Sayfa</h5>
                <div class="d-flex align-items-center">
                    <span class="me-2 text-muted small">HoÅŸgeldin,</span>
                    <span id="userDisplay" class="fw-bold text-dark">Admin</span>
                </div>
            </div>

            <div id="contentArea">
                <div class="row">
                    <div class="col-md-4">
                        <div class="stat-card border-start border-4 border-primary">
                            <h6 class="text-muted">Toplam MÃ¼ÅŸteri</h6>
                            <h3>124</h3>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="stat-card border-start border-4 border-success">
                            <h6 class="text-muted">Aktif SipariÅŸler</h6>
                            <h3>8</h3>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="stat-card border-start border-4 border-warning">
                            <h6 class="text-muted">Bekleyen GÃ¶revler</h6>
                            <h3>12</h3>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // API URL (AynÄ± kalacak)
        const API_URL = "https://script.google.com/macros/s/AKfycby6vg7szzK1m5UTCeLC2s8J82dSShpj5HiVmGDu40KKqxlmZShGAoRCoa9j5TbTJeV2Lw/exec";

        // Sayfa YÃ¼klendiÄŸinde
        document.addEventListener('DOMContentLoaded', () => {
            checkSession();
        });

        // 1. GÄ°RÄ°Åž Ä°ÅžLEMLERÄ°
        const loginForm = document.getElementById('loginForm');
        
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const btn = document.getElementById('loginBtn');
            const err = document.getElementById('loginError');
            
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Kontrol Ediliyor...';
            err.classList.add('d-none');

            const u = document.getElementById('username').value.trim();
            const p = document.getElementById('password').value.trim();

            fetch(API_URL, {
                method: "POST",
                body: JSON.stringify({ action: "login", username: u, password: p })
            })
            .then(r => r.json())
            .then(data => {
                btn.disabled = false;
                btn.innerText = 'GiriÅŸ Yap';
                
                if (data.status === "success") {
                    sessionStorage.setItem('crmToken', data.token);
                    sessionStorage.setItem('crmUser', JSON.stringify(data.user));
                    checkSession(); // Panele yÃ¶nlendir
                } else {
                    err.innerText = data.message || "Hata oluÅŸtu";
                    err.classList.remove('d-none');
                }
            })
            .catch(error => {
                btn.disabled = false;
                btn.innerText = 'GiriÅŸ Yap';
                err.innerText = "Sunucu HatasÄ±: " + error.message;
                err.classList.remove('d-none');
            });
        });

        // 2. OTURUM KONTROLÃœ
        function checkSession() {
            const token = sessionStorage.getItem('crmToken');
            const user = JSON.parse(sessionStorage.getItem('crmUser'));

            if (token && user) {
                document.getElementById('loginSection').classList.add('d-none'); // Gizle
                document.getElementById('dashboardSection').classList.remove('d-none'); // GÃ¶ster
                document.getElementById('userDisplay').innerText = user.name;
            } else {
                document.getElementById('loginSection').classList.remove('d-none'); // GÃ¶ster
                document.getElementById('dashboardSection').classList.add('d-none'); // Gizle
            }
        }

        // 3. Ã‡IKIÅž YAP
        function logout() {
            if(confirm("Ã‡Ä±kÄ±ÅŸ yapmak istediÄŸinize emin misiniz?")) {
                sessionStorage.clear();
                window.location.reload();
            }
        }

        // 4. SAYFA YÃ–NETÄ°MÄ° (ROUTER)
        function loadPage(pageName) {
            // MenÃ¼ aktifliÄŸini gÃ¼ncelle
            document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
            document.getElementById('nav-' + pageName).classList.add('active');

            const contentDiv = document.getElementById('contentArea');
            const titleDiv = document.getElementById('pageTitle');

            if (pageName === 'home') {
                titleDiv.innerText = "Ana Sayfa";
                contentDiv.innerHTML = `
                    <div class="row">
                        <div class="col-md-12 text-center py-5">
                            <h3 class="text-muted">HoÅŸgeldiniz!</h3>
                            <p>Sol menÃ¼den iÅŸlem yapabilirsiniz.</p>
                        </div>
                    </div>`;
            } 
            else if (pageName === 'customers') {
                titleDiv.innerText = "MÃ¼ÅŸteri Listesi";
                contentDiv.innerHTML = `
                    <div class="table-responsive">
                        <div class="d-flex justify-content-between mb-3">
                            <input type="text" class="form-control w-25" placeholder="MÃ¼ÅŸteri Ara...">
                            <button class="btn btn-primary"><i class="fas fa-plus"></i> Yeni Ekle</button>
                        </div>
                        <table class="table table-hover">
                            <thead class="table-light">
                                <tr><th>Firma AdÄ±</th><th>Yetkili</th><th>Telefon</th><th>Durum</th><th>Ä°ÅŸlem</th></tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="5" class="text-center py-4 text-muted">
                                        <i class="fas fa-sync fa-spin"></i> Veriler yÃ¼kleniyor... (HenÃ¼z BaÄŸlamadÄ±k)
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>`;
            }
            else {
                titleDiv.innerText = pageName.toUpperCase();
                contentDiv.innerHTML = `<div class="alert alert-info">Bu sayfa yapÄ±m aÅŸamasÄ±nda...</div>`;
            }
        }
    </script>
</body>
</html>
